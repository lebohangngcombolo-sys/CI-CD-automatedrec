[build]
base = "frontend"
command = """
bash -lc '
# Install Flutter if not cached
if [ ! -d "$HOME/flutter" ]; then
  git clone https://github.com/flutter/flutter.git -b stable --depth 1 $HOME/flutter
fi
export PATH="$HOME/flutter/bin:$PATH"

# Configure Flutter
flutter config --no-analytics
flutter precache --web

# Build the web app
flutter build web --release
'
"""
publish = "frontend/build/web"

[build.environment]
FLUTTER_WEB = "true"
NODE_VERSION = "18"  # Optional, for Node dependencies

# Optional: Configure redirects for SPA
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# Optional: Configure headers
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
Referrer-Policy = "strict-origin-when-cross-origin"
