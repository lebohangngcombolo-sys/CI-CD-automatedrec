[build]
base = "frontend"
command = """
bash -lc '
set -e

# Ensure VERSION exists in repo root (SemVer)
if [ ! -f ../VERSION ]; then
  echo "ERROR: VERSION file not found in repo root"
  exit 1
fi

SEMVER=$(cat ../VERSION)

# Calendar version must come from Netlify env
if [ -z "$APP_VERSION" ]; then
  echo "ERROR: APP_VERSION (calendar version) not set"
  exit 1
fi

echo "Building frontend with:"
echo "  SemVer:   $SEMVER"
echo "  CalVer:   $APP_VERSION"

# Install Flutter if not cached
if [ ! -d "$HOME/flutter" ]; then
  git clone https://github.com/flutter/flutter.git -b stable --depth 1 $HOME/flutter
fi
export PATH="$HOME/flutter/bin:$PATH"

# Configure Flutter
flutter config --no-analytics
flutter precache --web

# Build the web app WITH dual version injection
flutter build web --release \
  --dart-define=APP_SEMVER=$SEMVER \
  --dart-define=APP_VERSION=$APP_VERSION
'
"""
publish = "build/web"
